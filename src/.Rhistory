group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(animals = sum(count))
tmp <- all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(animals = sum(count))
View(tmp)
tmp
tmp <- all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = )
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count))
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(stage == 2 | stage == 6)]))
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)]))
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist)
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals)
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(stage)
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(vars(stage))
spring_infections <- read_csv("./export/spring_infections.csv") %>% mutate(season = "spring")
split_infections <- read_csv("./export/split_infections.csv") %>% mutate(season = "split")
batch_infections <- read_csv("./export/batch_infections.csv") %>% mutate(season = "batch")
all_infections <- reduce(list(spring_infections, split_infections, batch_infections), bind_rows) %>%
mutate(id = paste0(id,season)) %>% filter(step > 365*2 & step <= 2555)
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(vars(stage))
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
mutate(stage = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
)) %>%
mutate(stage = fct_relevel(stage, "Calves", "Weaned", "Heifers", "Pregnant heifers", "Lactating", "Dry")) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(vars(stage))
warnings()
ll_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
mutate(stage = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
))
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
mutate(stage = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
))
?fct_relevel
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
mutate(stage = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
)) %>%
mutate(stage = fct_relevel(stage, c("Calves", "Weaned", "Heifers", "Pregnant heifers", "Lactating", "Dry"))) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(vars(stage))
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
mutate(stagename = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
)) %>%
#mutate(stage = fct_relevel(stage, c("Calves", "Weaned", "Heifers", "Pregnant heifers", "Lactating", "Dry"))) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(vars(stagename))
facet_wrap(vars(fct_reorder(stagename, stage))
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
mutate(stagename = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
)) %>%
#mutate(stage = fct_relevel(stage, c("Calves", "Weaned", "Heifers", "Pregnant heifers", "Lactating", "Dry"))) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(vars(fct_reorder(stagename, stage)))
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
mutate(stagename = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
)) %>%
#mutate(stage = fct_relevel(stage, c("Calves", "Weaned", "Heifers", "Pregnant heifers", "Lactating", "Dry"))) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(vars(fct_reorder(stagename, stage)))  +
theme_minimal() +
ylab("Point prevalence (%)") +
ggtitle("Point prevalence of resistance by life stage") +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank())
all_infections %>%
select(step, season, stage, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(animals = sum(count)) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, animals, resist) %>%
mutate(prev_resist = 100*resist/animals) %>%
mutate(stagename = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
)) %>%
#mutate(stage = fct_relevel(stage, c("Calves", "Weaned", "Heifers", "Pregnant heifers", "Lactating", "Dry"))) %>%
ggplot(aes(y = prev_resist)) +
geom_boxplot() +
facet_wrap(vars(fct_reorder(stagename, stage)))  +
theme_minimal() +
ylab("Point prevalence (%)") +
ggtitle("Point prevalence of resistance by life stage") +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank())
all_infections %>%
select(step, season, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season, stage) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected)
all_infections %>%
select(step, season, status) %>%
group_by(step, season, stage, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected)
all_infections %>%
select(step, season, status) %>%
group_by(step, season, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected)
all_infections %>%
select(step, season, status) %>%
group_by(step, season, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected) %>%
mutate(stagename = case_when(
stage == 1 ~ "Calves",
stage == 2 ~ "Weaned",
stage == 3 ~ "Heifers",
stage == 4 ~ "Pregnant heifers",
stage == 5 ~ "Lactating",
stage == 6 ~ "Dry"
)) %>%
#mutate(stage = fct_relevel(stage, c("Calves", "Weaned", "Heifers", "Pregnant heifers", "Lactating", "Dry"))) %>%
ggplot(aes(y = perc_resist)) +
geom_boxplot() +
facet_wrap(vars(fct_reorder(stagename, stage)))  +
theme_minimal() +
ylab("Point prevalence (%)") +
ggtitle("Point prevalence of resistance by life stage") +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank())
all_infections %>%
select(step, season, status) %>%
group_by(step, season, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected) %>%
ggplot(aes(y = perc_resist)) +
geom_boxplot() +
facet_wrap(vars(season))  +
theme_minimal() +
ylab("Point prevalence (%)") +
ggtitle("Point prevalence of resistance by life stage") +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank())
all_infections %>%
select(step, season, status) %>%
group_by(step, season, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected) %>%
ggplot(aes(y = perc_resist)) +
geom_boxplot() +
facet_wrap(vars(season))  +
theme_minimal() +
ylab("Percentage of infections resistant") +
ggtitle("Percentage of resistant infections by calving system") +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank())
all_infections %>%
select(step, season, status) %>%
group_by(step, season, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected) %>%
mutate(season = case_when(
season == "batch" ~ "Batch",
season == "split" ~ "Split",
season == "spring" ~ "Spring"
)) %>%
ggplot(aes(y = perc_resist)) +
geom_boxplot() +
facet_wrap(vars(season))  +
theme_minimal() +
ylab("Percentage of infections resistant") +
ggtitle("Percentage of resistant infections by calving system") +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank())
all_infections %>%
select(step, season, status) %>%
group_by(step, season, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected) %>%
summary(perc_resist)
all_infections %>%
select(step, season, status) %>%
group_by(step, season, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected) %>%
ungroup() %>%
summary(perc_resist)
all_infections %>%
select(step, season, status) %>%
group_by(step, season, status) %>%
summarise(count = n()) %>%
group_by(step, season) %>%
mutate(infected = sum(count[which(status == 2 | status == 6 | status == 1 | status == 5)])) %>%
mutate(resist = sum(count[which(status == 2 | status == 6)])) %>%
distinct(step, season, infected, resist) %>%
mutate(perc_resist = 100*resist/infected) %>%
ungroup() %>%
summary(perc_resist)
prev
median(prev$prev_perc)
max(prev$prev_perc)
mean(prev$prev_perc)
examples %>%
rowwise() %>%
mutate(animals = num_calves + num_weaned + num_heifers + num_dh + num_lactating + num_dry) %>%
mutate(prev_r = 100*pop_r/animals,
prev_s = 100*pop_s/animals,
prev_p = 100*pop_p/animals,
prev_rec = 100*((pop_rec_r+pop_rec_p)/animals),
prev_car_p = 100*pop_car_p/animals,
prev_car_r = 100*pop_car_r/animals,
prev_clin = 100*clinical/animals) %>%
select(step, season, prev_r, prev_s, prev_p, prev_car_p, prev_car_r, prev_clin
, prev_rec
)
examples %>%
rowwise() %>%
mutate(animals = num_calves + num_weaned + num_heifers + num_dh + num_lactating + num_dry) %>%
mutate(prev_r = 100*pop_r/animals,
prev_s = 100*pop_s/animals,
prev_p = 100*pop_p/animals,
prev_rec = 100*((pop_rec_r+pop_rec_p)/animals),
prev_car_p = 100*pop_car_p/animals,
prev_car_r = 100*pop_car_r/animals,
prev_clin = 100*clinical/animals,
prev = 100*(prev_r+prev_p+prev_car_r+prev_car_p)/animals)
examples %>%
rowwise() %>%
mutate(animals = num_calves + num_weaned + num_heifers + num_dh + num_lactating + num_dry) %>%
mutate(prev_r = 100*pop_r/animals,
prev_s = 100*pop_s/animals,
prev_p = 100*pop_p/animals,
prev_rec = 100*((pop_rec_r+pop_rec_p)/animals),
prev_car_p = 100*pop_car_p/animals,
prev_car_r = 100*pop_car_r/animals,
prev_clin = 100*clinical/animals,
prev = 100*(prev_r+prev_p+prev_car_r+prev_car_p)/animals) %>%
summary(prev)
prev_plot
x11(); prev_plot
examples %>%
rowwise() %>%
mutate(animals = num_calves + num_weaned + num_heifers + num_dh + num_lactating + num_dry) %>%
mutate(prev_r = 100*pop_r/animals,
prev_s = 100*pop_s/animals,
prev_p = 100*pop_p/animals,
prev_rec = 100*((pop_rec_r+pop_rec_p)/animals),
prev_car_p = 100*pop_car_p/animals,
prev_car_r = 100*pop_car_r/animals,
prev_clin = 100*clinical/animals,
prev = 100*(pop_r+pop_p+pop_car_r+pop_car_p)/animals) %>%
summary(prev)
examples %>%
rowwise() %>%
mutate(animals = num_calves + num_weaned + num_heifers + num_dh + num_lactating + num_dry) %>%
mutate(prev_r = 100*pop_r/animals,
prev_s = 100*pop_s/animals,
prev_p = 100*pop_p/animals,
prev_rec = 100*((pop_rec_r+pop_rec_p)/animals),
prev_car_p = 100*pop_car_p/animals,
prev_car_r = 100*pop_car_r/animals,
prev_clin = 100*clinical/animals,
prev = 100*(pop_r+pop_p+pop_car_r+pop_car_p)/animals,
prev_all_r = 100*(pop_r+pop_car_r)/animals) %>%
summary(prev)
examples %>%
rowwise() %>%
mutate(animals = num_calves + num_weaned + num_heifers + num_dh + num_lactating + num_dry) %>%
mutate(prev_r = 100*pop_r/animals,
prev_s = 100*pop_s/animals,
prev_p = 100*pop_p/animals,
prev_rec = 100*((pop_rec_r+pop_rec_p)/animals),
prev_car_p = 100*pop_car_p/animals,
prev_car_r = 100*pop_car_r/animals,
prev_clin = 100*clinical/animals,
prev = 100*(pop_r+pop_p+pop_car_r+pop_car_p)/animals,
prev_all_r = 100*(pop_r+pop_car_r)/animals,
prev_res_inf = 100*(pop_r+pop_car_r)/(pop_p+pop_car+p+pop_r+pop_car_r)) %>%
summary(prev)
examples %>%
rowwise() %>%
mutate(animals = num_calves + num_weaned + num_heifers + num_dh + num_lactating + num_dry) %>%
mutate(prev_r = 100*pop_r/animals,
prev_s = 100*pop_s/animals,
prev_p = 100*pop_p/animals,
prev_rec = 100*((pop_rec_r+pop_rec_p)/animals),
prev_car_p = 100*pop_car_p/animals,
prev_car_r = 100*pop_car_r/animals,
prev_clin = 100*clinical/animals,
prev = 100*(pop_r+pop_p+pop_car_r+pop_car_p)/animals,
prev_all_r = 100*(pop_r+pop_car_r)/animals,
prev_res_inf = 100*(pop_r+pop_car_r)/(pop_p+pop_car_p+pop_r+pop_car_r)) %>%
summary(prev)
